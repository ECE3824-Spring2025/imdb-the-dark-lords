<!doctype html>
<html>

<!--Website Title-->

<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <title> IMDB Dark Lord Dungeon </title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <div class="banner">
        <h1> IMDB </h1> <!--header text-->

    </div>

    <!--Text-->
    <h1> The Dark Lord Dungeon </h1> <!--header text-->
    <h2> GENRE: {{ type }} </h2> <!--subheader text-->

    <!--FORM FOR DROPDOWN-->
    <form method="GET" action="#">
        <select name="genre" id="genre">
            <option value="none" selected hidden disabled>select a genre</option>
            <option value="comedy"> comedy </option>
            <option value="drama"> drama </option>
            <option value="action"> action </option>
        </select>
        <input type="submit">
    </form>

    <h3> top 10 by rating </h3> <!-- text-->
    <h4> top 10 by vote </h4> <!-- text-->

    <!-- square 1-->
    <div class="square1">
        {% if rating_data or likes_data %}
        <div class="lists-container">
            {% if rating_data %}
            <div>
                <h2>Ratings List</h2>
                <ul>
                    {% for movie in rating_data %}
                    <li>{{ movie.name }} — Rating: {{ movie.rating }} <button class="add-favorite" data-id="{{ movie.id }}" data-name="{{ movie.name }}" data-rating="{{ movie.rating }}">Add to Favorites</button> </li>
                    
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
        {% else %}
        <p>No genre selected or no data to display.</p>
        {% endif %}
    </div>

    <!-- square 2-->
    <div class="square2">
        {% if likes_data %}
        <div>
            <h2>Voting list</h2>
            <ul>
                {% for movie in likes_data %}
                <li>{{ movie.name }} — Votes: {{ movie.votes }}  <button class="add-favorite" data-id="{{ movie.id }}" data-name="{{ movie.name }}" data-votes="{{ movie.votes }}">Add to Favorites</button>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

    </div>
    
    <!-- square 3-->
    <div class="square3">
        <h2>Favorites List</h2>
        <ul id="favorites-list">
            {% if favs_data %}
                {% for movie in favs_data %}
                <li>
                    {{movie.name}} - Rating: {{movie.rating }}
                    <button class="remove-favorite" data-id="{{ movie.id }}">Remove</button>
                </li>
                {% endfor %}
            {% else %}
            <li> id="no-favs">No favorites added yet.</li>
            {% endif %}
        </ul>
    </div>

    <script>
        $(document).ready(function() {
            $('.add-favorite').click(function() {
                var movieData = {
                    id: $(this).data('id'),
                    name: $(this).data('name'),
                    rating: $(this).data('rating') || $(this).data('votes')
                };
                $.ajax({
                    url: '/add_favorite',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(movieData),
                    success: function(response) {
                        if (response.status === 'success') {
                            $('#no-favorites').remove();
                            $('#favorites-list').append('<li>' + movieData.name + ' - Rating: ' + movieData.rating + 
                                ' <button class="remove-favorite" data-id="' + movieData.id + '">Remove</button></li>');
                        }
                    }
                });
            });

            $(document).on('click', '.remove-favorite', function() {
                var movieId = $(this).data('id');
                var listItem = $(this).parent();
                $.ajax({
                    url: '/remove_favorite',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({id: movieId}),
                    success: function(response) {
                        if (response.status === 'success') {
                            listItem.remove();
                            if ($('#favorites-list li').length === 0) {
                    $('#favorites-list').append('<li id="no-favorites">No favorites added yet.</li>'); }
                        }
                    }
                });
            });
        });
    </script>

</div>



</body>

</html>