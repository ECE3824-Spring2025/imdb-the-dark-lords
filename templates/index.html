<!doctype html>
<html>

<!--Website Title-->

<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <title> IMDB Dark Lord Dungeon </title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <div class="banner">
        <h1> IMDB </h1> <!--header text-->

    </div>

    <!--Text-->
    <h1> The Dark Lord Dungeon </h1> <!--header text-->
    <h2> GENRE: {{ genre }} </h2> <!--subheader text-->

    <!--FORM FOR DROPDOWN-->
    <form method="GET" action="#">
        <select name="genre" id="genre">
            <option value="none" selected hidden disabled>select a genre</option>
            <option value="comedy"> comedy </option>
            <option value="drama"> drama </option>
            <option value="action"> action </option>
        </select>
        <input type="submit">
    </form>

    
    <!--<h3> top 10 by rating </h3> <!-- text-->
    <!--<h4> top 10 by vote </h4> <!-- text-->
    

    <!-- square 1-->
    <div class="squares-header">
        <h4>Top 10 by Rating</h4>
        <div class="square1">
            <div class="header-container">
                <h5> Movie Title </h5> <!-- text-->
                <h6> Rating </h6> <!-- text-->
            </div>
            {% if rating_data or likes_data %}
            <div class="lists-container">
                {% if rating_data %}
                <div>
                    <ul>
                        {% for movie in rating_data %}
                        <li class ="movie-item">     
                            <img src="{{ movie.poster }}" alt="{{ movie.name }} poster" width="150">              
                            <span class="movie-name">{{ movie.name }}</span>
                            <span class="movie-rating"># {{ movie.rating }}</span>                       
                            <button class="add-favorite" data-id="{{ movie.id }}" data-name="{{ movie.name }}" data-rating="{{ movie.rating }}">Add to Favorites</button>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
            {% else %}
            <p>No genre selected or no data to display.</p>
            {% endif %}
        </div>
    </div>

    <div class="square-header">
        <h3>Top 10 by Votes</h3>
        <!-- square 2-->
        <div class="square2">
            <div class="header-container">
                <h5> Movie Title </h5> <!-- text-->
                <h6> Votes </h6> <!-- text-->
            </div>
            {% if likes_data %}
            <div class="lists-container">
                <div>
                    <ul>
                        {% for movie in likes_data %}
                        <li class="movie-item">
                            <img src="{{ movie.poster }}" alt="{{ movie.name }} poster" width="150">
                            <span class="movie-name">{{ movie.name }}</span>
                            <span class="movie-votes"># {{ movie.votes }}</span>
                            <button class="add-favorite" data-id="{{ movie.id }}" data-name="{{ movie.name }}" data-votes="{{ movie.votes }}">Add to Favorites</button>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            {% else %}
        <p>No data to display.</p>
        {% endif %}
    </div>
    
    <div class="square-header">
        <!--<h4>Favorites List</h4>*/-->
        <!-- square 3-->
        <div class="square3">
            <h2>Favorites List</h2>
            <ul id="favorites-list">
                {% if favs_data %}
                {% for movie in favs_data %}
                <li>
                    {{movie.name}} - Rating: {{movie.rating }}
                    <button class="remove-favorite" data-id="{{ movie.id }}">Remove</button>
                </li>
                {% endfor %}
                {% else %}
                <li> id="no-favs">No favorites added yet.</li>
                {% endif %}
            </ul>
        </div>
    </div>



    <script>
        $(document).ready(function() {
            $('.add-favorite').click(function() {
                var movieData = {
                    id: $(this).data('id'),
                    name: $(this).data('name'),
                    rating: $(this).data('rating') || $(this).data('votes')
                };
                $.ajax({
                    url: '/add_favorite',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(movieData),
                    success: function(response) {
                        if (response.status === 'success') {
                            $('#no-favorites').remove();
                            $('#favorites-list').append('<li>' + movieData.name + ' - Rating: ' + movieData.rating + 
                                ' <button class="remove-favorite" data-id="' + movieData.id + '">Remove</button></li>');
                        }
                    }
                });
            });

            $(document).on('click', '.remove-favorite', function() {
                var movieId = $(this).data('id');
                var listItem = $(this).parent();
                $.ajax({
                    url: '/remove_favorite',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({id: movieId}),
                    success: function(response) {
                        if (response.status === 'success') {
                            listItem.remove();
                            if ($('#favorites-list li').length === 0) {
                    $('#favorites-list').append('<li id="no-favorites">No favorites added yet.</li>'); }
                        }
                    }
                });
            });
        });
    </script>

</div>



</body>

</html>